prefix=@prefix@
SYSCONFDIR=@sysconfdir@
BINDIR=@bindir@
LIBEXECDIR=@libexecdir@
LIBDIR=@libdir@
CGIDIR=@sbindir@
HTMLDIR=@datarootdir@
INSTALL=@INSTALL@
INSTALL_OPTS=@INSTALL_OPTS@
BACKUP=-b -S .orig
LN_S=@LN_S@
PERFDATADIR=@PERFDATA_DIR@
DATAROOTDIR=@datarootdir@
PACKAGE_NAME=@PACKAGE_NAME@
PACKAGE_VERSION=@PACKAGE_VERSION@
NAG_OBJ=@NAGIOS_OBJ@
NAG_CFG=@NAGIOS_CFG@
NAG_PWD=@NAGIOS_PWD@
NAG_VER=@NAGIOS_VER@
HTTP_SERVER=@HTTP_SERVER@
HTTP_CONFDIR=@HTTP_CONFDIR@
CP=@CP@
PERL=@PERL@
PAPERSIZE=@PAPERSIZE@

all:

clean:
	-rm -f config_samples/config.php
	-rm -f config_samples/nagios_*.cfg
	-rm -f config_samples/templates.cfg
	-rm -f config_samples/process_perfdata.cfg
	-rm -f config_samples/npcd.cfg
	-rm -f config_samples/pnp-*.cfg 
	-rm -f pnp4nagios_release
	-rm -f config_samples/apache.pnp4nagios.conf
	-rm -f config_samples/lighttpd.pnp4nagios.conf
	-rm -f config_samples/nginx.pnp4nagios.conf
	-rm -f config_tools/NagiosCfgMod.pl
	-rm -f README_config.md

distclean: clean
	-rm -f Makefile

devclean: distclean


config_samples/nagios-sync.cfg:
	$(PERL) config_tools/NagiosCfgMod.pl -i $(NAG_CFG) -o config_samples/nagios-sync.cfg -n $(NAG_VER) -m sync

config_samples/nagios-bulk.cfg:
	$(PERL) config_tools/NagiosCfgMod.pl -i $(NAG_CFG) -o config_samples/nagios-bulk.cfg -n $(NAG_VER) -m bulk

config_samples/nagios-npcd.cfg:
	$(PERL) config_tools/NagiosCfgMod.pl -i $(NAG_CFG) -o config_samples/nagios-npcd.cfg -n $(NAG_VER) -m npcd

config_samples/templates.cfg:
	$(PERL) config_tools/TemplateMod.pl -i $(NAG_OBJ)/templates.cfg -o config_samples/templates.cfg


install: collection_method install-contrib
	$(INSTALL) -m 755 $(INSTALL_OPTS) -d $(DESTDIR)$(SYSCONFDIR)
	$(INSTALL) -m 755 $(INSTALL_OPTS) -d $(DESTDIR)$(SYSCONFDIR)/config.d
	$(INSTALL) -m 755 $(INSTALL_OPTS) -d $(DESTDIR)$(SYSCONFDIR)/check_commands
	$(INSTALL) -m 755 $(INSTALL_OPTS) -d $(DESTDIR)$(SYSCONFDIR)/pages
	$(INSTALL) -m 755 $(INSTALL_OPTS) -d $(DESTDIR)$(SYSCONFDIR)/config_tools
	$(INSTALL) -m 755 $(INSTALL_OPTS) -d $(DESTDIR)$(SYSCONFDIR)/config_samples
	$(INSTALL) -m 755 $(INSTALL_OPTS) SetLogLevels   $(DESTDIR)$(SYSCONFDIR)/
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) config_tools/*.pl $(DESTDIR)$(SYSCONFDIR)/config_tools/
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) config_tools/verify_pnp_config $(DESTDIR)$(SYSCONFDIR)/
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) check_commands/* $(DESTDIR)$(SYSCONFDIR)/check_commands/
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) config_samples/*.cfg $(DESTDIR)$(SYSCONFDIR)/config_samples/
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) config_samples/*.conf $(DESTDIR)$(SYSCONFDIR)/config_samples/
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) config_samples/config.php $(DESTDIR)$(SYSCONFDIR)/
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) config_samples/process_perfdata.cfg $(DESTDIR)$(SYSCONFDIR)/process_perfdata.cfg
	$(INSTALL) -m 755 $(INSTALL_OPTS) $(BACKUP) config_samples/npcd.cfg $(DESTDIR)$(SYSCONFDIR)/npcd.cfg
	$(INSTALL) -m 644 $(INSTALL_OPTS) collection_method $(DESTDIR)$(SYSCONFDIR)/
	$(INSTALL) -m 644 $(INSTALL_OPTS) pnp4nagios_release $(DESTDIR)$(SYSCONFDIR)/
	if ! diff -q pages/background-A4.pdf $(DESTDIR)$(SYSCONFDIR)/pages/ >/dev/null 2>&1 ; then \
		$(INSTALL) -m 644 $(INSTALL_OPTS) $(BACKUP) pages/background-A4.pdf $(DESTDIR)$(SYSCONFDIR)/pages/ ; \
	fi
	if ! diff -q pages/background-letter.pdf $(DESTDIR)$(SYSCONFDIR)/pages/ >/dev/null 2>&1 ; then \
		$(INSTALL) -m 644 $(INSTALL_OPTS) $(BACKUP) pages/background-letter.pdf $(DESTDIR)$(SYSCONFDIR)/pages ; \
	fi
	if [ ! -e $(DESTDIR)$(SYSCONFDIR)/background.pdf ] ; then \
		ln -rs $(DESTDIR)$(SYSCONFDIR)/pages/background-$(PAPERSIZE).pdf $(DESTDIR)$(SYSCONFDIR)/background.pdf ;\
	fi



install-contrib:
	$(INSTALL) -m 755 -d $(DESTDIR)$(SYSCONFDIR)/contrib
	$(INSTALL) -m 644 $(BACKUP) ../contrib/ssi/status-header.ssi $(DESTDIR)$(SYSCONFDIR)/contrib
	$(INSTALL) -m 644 $(BACKUP) ../contrib/fedora/pnp4nagios.logrotate.conf $(DESTDIR)$(SYSCONFDIR)/contrib
	$(INSTALL) -m 644 -D $(BACKUP) ../contrib/fedora/logwatch/conf/logfiles/pnp4nagios.conf $(DESTDIR)$(SYSCONFDIR)/contrib/logwatch/conf/logfiles/pnp4nagios.conf
	$(INSTALL) -m 644 -D $(BACKUP) ../contrib/fedora/logwatch/conf/services/pnp4nagios.conf $(DESTDIR)$(SYSCONFDIR)/contrib/logwatch/conf/services/pnp4nagos.conf
	$(INSTALL) -m 644 -D $(BACKUP) ../contrib/fedora/logwatch/scripts/services/pnp4nagios $(DESTDIR)$(SYSCONFDIR)/contrib/logwatch/scripts/services/pnp4nagios



install-http: 
	$(INSTALL) -m 755 -d $(DESTDIR)$(HTTP_CONFDIR)
	$(INSTALL) -m 644 $(BACKUP) config_samples/$(HTTP_SERVER).pnp4nagios.conf $(DESTDIR)$(HTTP_CONFDIR)/pnp4nagios.conf

use_sync: config_samples/nagios-sync.cfg
	$(INSTALL) -m 755 -d $(DESTDIR)$(NAG_OBJ)
	$(INSTALL) -m 644 config_samples/pnp-sync.cfg $(DESTDIR)$(NAG_OBJ)/pnp.cfg
	$(INSTALL) -m 644 $(BACKUP) config_samples/nagios-sync.cfg $(DESTDIR)$(NAG_CFG)
	$(INSTALL) -m 644 $(BACKUP) config_samples/templates.cfg $(DESTDIR)$(NAG_OBJ)/templates.cfg
	echo "sync" >collection_method

use_bulk: config_samples/nagios-bulk.cfg
	$(INSTALL) -m 755 -d $(DESTDIR)$(NAG_OBJ)
	$(INSTALL) -m 644 config_samples/pnp-bulk.cfg $(DESTDIR)$(NAG_OBJ)/pnp.cfg
	$(INSTALL) -m 644 $(BACKUP) config_samples/nagios-bulk.cfg $(DESTDIR)$(NAG_CFG)
	$(INSTALL) -m 644 $(BACKUP) config_samples/templates.cfg $(DESTDIR)$(NAG_OBJ)/templates.cfg
	echo "bulk" >collection_method

use_npcd: config_samples/nagios-npcd.cfg
	$(INSTALL) -m 755 -d $(DESTDIR)$(NAG_OBJ)
	$(INSTALL) -m 644 config_samples/pnp-npcd.cfg $(DESTDIR)$(NAG_OBJ)/pnp.cfg
	$(INSTALL) -m 644 $(BACKUP) config_samples/nagios-npcd.cfg $(DESTDIR)$(NAG_CFG)
	$(INSTALL) -m 644 $(BACKUP) config_samples/templates.cfg $(DESTDIR)$(NAG_OBJ)/templates.cfg
	echo "npcd" >collection_method

use_X: collection_method

collection_method:
	if ! -e "collection_method" ; then \
	$(MAKE) use_sync ;\
	fi
